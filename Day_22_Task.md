# Day 22:
### In this task, I have 
### > Set up a Prometheus server to monitor multiple services running on different nodes.
### > Used Node Exporter to monitor system-level metrics like CPU, memory, disk usage, and network statistics.
### > Configured at four different types of exporters Node Exporter, NGINX Prometheus Exporter and Postgres Exporter and also integrated them with the Prometheus.
### > Learnt and implemented basic PromQL queries to extract meaningful data from the metrics collected.
### > Created PromQL queries using selectors, functions, and operators to filter and manipulate time-series data.
### > Performed advance data aggregation using PromQL.
### > Set up of Alertmanager to handle alerts generated by Prometheus.
### > Wrote custom alerting rules in Prometheus to trigger alerts based on specific conditions.
### > Integrated Alertmanager with multiple notification channels like Email and Slack.
### > Also tested the entire alerting pipeline by creating and triggering custom alerts.


### First of all, I used docker container to use prometheus.
```
docker run -itd -p 9090:9090 prom/prometheus:latest
```

### Then, I created an EC2 instance and created multiple services on it to integrate with prometheus and for the data collection.

### The services I created on EC2 instance are Prometheus node exporter, nginx prometheus exporter and postgres exporter. Can be seen in the below images.

### In order to create these services, I used below docker images:

```
prom/node-exporter
nginx/nginx-prometheus-exporter:latest
prometheuscommunity/postgres-exporter
```

### I ran node-exporter on port number 9100, nginx-exporter on 9113 and postgres exporter on port number 9187.

![alt text](images/Day_22_Images/Image_3)

![alt text](images/Day_22_Images/Image_4)

![alt text](images/Day_22_Images/Image_5)

### I integrated all these services with the prometheus as can be seen in the below image:

![alt text](images/Day_22_Images/Image_6)

### Next, I ran a few PromQL queries in order to extract meaningful data from the metrics.

```
node_seconds_cpu_total
```

### Below image shows a graph of the above query.


![alt text](images/Day_22_Images/Image_8)

```
nginx_up
```

### This above PromQL query indicates that the NGINX instance is up and running.

![alt text](images/Day_22_Images/Image_9)


```
pg_up
```

### This above PromQL query indicates that the Postgres database is up and running.

![alt text](images/Day_22_Images/Image_10)

### Till now, all the PromQL queries were basic. From here, I ran a few advance PromQL queries.
### The below query is used to calculate the percentage of the CPU usage.
```
100 - (avg by (instance) (rate(node_cpu_seconds_total{mode="idle"}[5m])) * 100)
```

![alt text](images/Day_22_Images/Image_11)


### The below query computes the total increase in non-idle CPU time over the last 30 minutes.
```
increase(node_cpu_seconds_total{mode!="idle"}[30m])
```

![alt text](images/Day_22_Images/Image_12)

### The below query Calculate Total Memory Usage for Each Node.
```
node_memory_MemTotal_bytes - node_memory_MemFree_bytes
```
![alt text](images/Day_22_Images/Image_13)

### Next, I did the configuration of the Alert Manager. For that, first of all, I downloaded the package of alert maneger on my instance from the official website using the below command:

```
wget https://github.com/prometheus/alertmanager/releases/download/v0.27.0/alertmanager-0.27.0.linux-amd64.tar.gz
```
### Then, I untared the package using below command:
```
tar -xvf 'alertmanager-0.27.0.linux-amd64.tar.gz'
```
![alt text](images/Day_22_Images/Image_14)

### Then, I ran the script downloaded along with the package and added the IP address in the /etc/prometheus/prometheus.yml file.

![alt text](images/Day_22_Images/Image_15)

### Below is my alert.rules.yml file which I have added in /etc/prometheus/alert.rules.yml and also added its location in prometheus.yml file

![alt text](images/Day_22_Images/Image_17)

### The successful configuration of the alert manager can be seen in the below images:

![alt text](images/Day_22_Images/Image_16)
![alt text](images/Day_22_Images/Image_18)














